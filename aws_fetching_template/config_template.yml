AWSTemplateFormatVersion: 2010-09-09
Description: Firefly AWS Integration
Mappings:
  FireflyEnvironment:
    env:
      organizationID: "094724549126"
      SnsNameForConfirmCustomerDeployment: "handle-customer-actions"
Metadata:
  'AWS::CloudFormation::Interface':
    ParameterGroups:
      - Parameters:
          - ExternalID
    ParameterLabels:
      ExternalID:
        default: ExternalID
Parameters:
  ExternalID:
    Description: >-
      The cross-account access role created by the stack will use this value for
      its ExternalID. Do not change this value!
    Type: String
    MinLength: '2'
    MaxLength: '1224'
    AllowedPattern: '[\w+=,.@:\/-]*'
    ConstraintDescription: 'Invalid ExternalID value.  Must match pattern [\w+=,.@:\/-]*'
Conditions: {}
Resources:

  FireflyReadonlyPolicy:
    Type: 'AWS::IAM::ManagedPolicy'
    Properties:
      PolicyDocument:
        Version: 2012-10-17
        Statement:            
          - Effect: Allow
            Action:
              - 'kms:Decrypt'
            Resource:
              - !Join [':', ['arn:aws:kms:*', !Ref 'AWS::AccountId', 'key/*']]

        Statement:
          - Effect: Allow
            Action: [
              'apigateway:GET',
              'cloudwatch:ListDashboards',
              'cloudwatch:GetDashboard',
              'codebuild:BatchGetProjects',
              'ec2:SearchTransitGatewayRoutes',
              'eks:ListNodegroups',
              'eks:ListFargateProfiles',
              'eks:ListTagsForResource',
              'eks:DescribeNodegroup',
              'eks:DescribeFargateProfile',
              'states:DescribeStateMachine',
              'states:ListStateMachines',
              'states:ListTagsForResource',
              'sns:ListSubscriptionsByTopic',
              'sns:ListTopics',
              'sns:ListSubscriptions',
              'ses:GetIdentityMailFromDomainAttributes',
              'ses:GetIdentityVerificationAttributes',
              'sns:GetSubscriptionAttributes',
              'ses:GetIdentityDkimAttributes',
              'ses:ListIdentities',
              'elasticfilesystem:DescribeLifecycleConfiguration',
              'ecr-public:ListTagsForResource',
              'ecr:DescribeRepositories',
              'appconfig:ListApplications',
              'appconfig:ListTagsForResource',
              'eks:ListIdentityProviderConfigs',
              'eks:DescribeIdentityProviderConfig',
              'eks:ListAddons',
              'eks:DescribeAddon',
              'elasticfilesystem:DescribeAccessPoints',
              'elasticfilesystem:ListTagsForResource',
              's3:ListBucket'
              ]
            Resource:
              - '*'
          - Effect: Allow
            Action:
              - 's3:GetObject'
            Resource:
              - 'arn:aws:s3:::*/*.tfstate'
              - 'arn:aws:s3:::elasticbeanstalk-*/*'
              - !Join ['/', [!Join ['-', ['arn:aws:s3:::aws-emr-resources', !Ref 'AWS::AccountId', '*']], '*']]
  FireflyReadonlyPolicyPart1:
    Type: 'AWS::IAM::ManagedPolicy'
    Properties:
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action: [
              'access-analyzer:Get*',
                'access-analyzer:List*',
                'account:Get*',
                'account:List*',
                'acm-pca:DescribeCertificateAuthority',
                'acm-pca:Get*',
                'acm-pca:List*',
                'acm:DescribeCertificate',
                'acm:GetAccountConfiguration',
                'acm:List*',
                'airflow:Get*',
                'airflow:List*',
                'amplify:Get*',
                'amplify:List*',
                'apigateway:Get*',
                'app-integrations:Get*',
                'app-integrations:List*',
                'appconfig:Get*',
                'appconfig:List*',
                'appflow:Describe*',
                'appflow:List*',
                'application-autoscaling:Describe*',
                'appmesh:Describe*',
                'appmesh:List*',
                'apprunner:Describe*',
                'apprunner:List*',
                'appstream:Describe*',
                'appstream:List*',
                'appsync:Get*',
                'appsync:List*',
                'aps:Describe*',
                'aps:List*',
                'athena:GetDatabase',
                'athena:GetNamedQuery',
                'athena:GetTableMetadata',
                'athena:GetWorkGroup',
                'athena:ListDatabases',
                'athena:ListEngineVersions',
                'athena:ListNamedQueries',
                'athena:ListTagsForResource',
                'athena:ListWorkGroups',
                'autoscaling-plans:Describe*',
                'autoscaling:Describe*',
                'backup-gateway:List*',
                'backup:Describe*',
                'backup:Get*',
                'backup:List*',
                'batch:Describe*',
                'batch:List*',
                'braket:Get*',
                'budgets:Describe*',
                'chime:GetVoiceConnector*',
                'chime:ListTagsForResource',
                'chime:ListVoiceConnector*',
                'cloud9:Describe*',
                'cloud9:List*',
                'cloudformation:Describe*',
                'cloudformation:Get*',
                'cloudformation:List*',
                'cloudfront:Describe*',
                'cloudfront:Get*',
                'cloudfront:List*',
                'cloudhsm:Describe*',
                'cloudhsm:Get*',
                'cloudhsm:List*',
                'cloudsearch:Describe*',
                'cloudsearch:List*',
                'cloudtrail:Describe*',
                'cloudtrail:Get*',
                'cloudtrail:List*',
                'cloudwatch:DescribeAlarms',
                'codeartifact:Describe*',
                'codeartifact:Get*',
                'codeartifact:List*',
                'codebuild:Describe*',
                'codebuild:Get*',
                'codebuild:List*',
                'codecommit:Describe*',
                'codecommit:GetApprovalRuleTemplate',
                'codecommit:GetRepository',
                'codecommit:GetRepositoryTriggers',
                'codecommit:List*',
                'codedeploy:Get*',
                'codedeploy:List*',
                'codeguru-profiler:DescribeProfilingGroup',
                'codeguru-profiler:GetProfile',
                'codeguru-profiler:List*',
                'codeguru-reviewer:Describe*',
                'codeguru-reviewer:List*',
                'codepipeline:Get*',
                'codepipeline:List*',
                'codestar-connections:Get*',
                'codestar-connections:List*',
                'codestar-notifications:Describe*',
                'codestar-notifications:List*',
                'codestar:Describe*',
                'codestar:List*',
                'cognito-identity:Describe*',
                'cognito-identity:GetId',
                'cognito-identity:GetIdentityPoolRoles',
                'cognito-identity:GetPrincipalTagAttributeMap',
                'cognito-identity:List*',
                'cognito-idp:Describe*',
                'cognito-idp:GetCSVHeader',
                'cognito-idp:GetDevice',
                'cognito-idp:GetGroup',
                'cognito-idp:GetIdentityProviderByIdentifier',
                'cognito-idp:GetUICustomization',
                'cognito-idp:GetUser',
                'cognito-idp:GetUserAttributeVerificationCode',
                'cognito-idp:GetUserPoolMfaConfig',
                'cognito-idp:List*',
                'cognito-sync:Describe*',
                'cognito-sync:Get*',
                'cognito-sync:List*',
                'comprehend:Describe*',
                'comprehend:List*',
                'comprehendmedical:Describe*',
                'comprehendmedical:List*',
                'compute-optimizer:Describe*',
                'compute-optimizer:Get*',
                'config:Describe*',
                'config:Get*',
                'config:List*',
                'connect:Describe*',
                'connect:GetContactAttributes',
                'connect:List*',
                'cur:DescribeReportDefinitions',
                'databrew:Describe*',
                'databrew:List*',
                'dataexchange:Get*',
                'dataexchange:List*',
                'datapipeline:Describe*',
                'datapipeline:Get*',
                'datapipeline:List*',
                'datasync:Describe*',
                'datasync:List*',
                'dax:Describe*',
                'dax:List*',
                'detective:Get*',
                'detective:List*',
                'devicefarm:Get*',
                'devicefarm:List*',
                'devops-guru:Describe*',
                'devops-guru:Get*',
                'devops-guru:List*',
                'directconnect:Describe*',
                'directconnect:List*',
                'discovery:Describe*',
                'discovery:Get*',
                'discovery:List*',
                'dlm:Get*',
                'dlm:List*',
                'dms:Describe*',
                'dms:List*',
                'ds:DescribeClientAuthenticationSettings',
                'ds:DescribeConditionalForwarders',
                'ds:DescribeDirectories',
                'ds:DescribeDomainControllers',
                'ds:DescribeEventTopics',
                'ds:DescribeLDAPSSettings',
                'ds:DescribeRegions',
                'ds:DescribeSharedDirectories',
                'ds:DescribeSnapshots',
                'ds:DescribeTrusts',
                'ds:GetDirectoryLimits',
                'ds:GetSnapshotLimits',
                'ds:ListIpRoutes',
                'ds:ListLogSubscriptions',
                'ds:ListSchemaExtensions',
                'ds:ListTagsForResource',
                'dynamodb:DescribeBackup',
                'dynamodb:DescribeContinuousBackups',
                'dynamodb:DescribeContributorInsights',
                'dynamodb:DescribeExport',
                'dynamodb:DescribeGlobalTable',
                'dynamodb:DescribeGlobalTableSettings',
                'dynamodb:DescribeKinesisStreamingDestination',
                'dynamodb:DescribeLimits',
                'dynamodb:DescribeStream',
                'dynamodb:DescribeTable',
                'dynamodb:DescribeTableReplicaAutoScaling',
                'dynamodb:DescribeTimeToLive',
                'dynamodb:GetItem',
                'dynamodb:GetRecords',
                'dynamodb:GetShardIterator',
                'dynamodb:ListBackups',
                'dynamodb:ListContributorInsights',
                'dynamodb:ListExports',
                'dynamodb:ListGlobalTables',
                'dynamodb:ListStreams',
                'dynamodb:ListTables',
                'dynamodb:ListTagsOfResource'
              ]
            Resource:
              - '*'
  FireflyReadonlyPolicyPart2:
    Type: 'AWS::IAM::ManagedPolicy'
    Properties:
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action: [
              'ebs:GetSnapshotBlock',
                'ebs:ListChangedBlocks',
                'ebs:ListSnapshotBlocks',
                'ec2:Describe*',
                'ec2:GetAssociatedEnclaveCertificateIamRoles',
                'ec2:GetAssociatedIpv6PoolCidrs',
                'ec2:GetCapacityReservationUsage',
                'ec2:GetCoipPoolUsage',
                'ec2:GetConsoleOutput',
                'ec2:GetConsoleScreenshot',
                'ec2:GetDefaultCreditSpecification',
                'ec2:GetEbsDefaultKmsKeyId',
                'ec2:GetEbsEncryptionByDefault',
                'ec2:GetFlowLogsIntegrationTemplate',
                'ec2:GetGroupsForCapacityReservation',
                'ec2:GetHostReservationPurchasePreview',
                'ec2:GetInstanceTypesFromInstanceRequirements',
                'ec2:GetIpamAddressHistory',
                'ec2:GetIpamPoolAllocations',
                'ec2:GetIpamPoolCidrs',
                'ec2:GetIpamResourceCidrs',
                'ec2:GetLaunchTemplateData',
                'ec2:GetManagedPrefixListAssociations',
                'ec2:GetManagedPrefixListEntries',
                'ec2:GetNetworkInsightsAccessScopeAnalysisFindings',
                'ec2:GetNetworkInsightsAccessScopeContent',
                'ec2:GetPasswordData',
                'ec2:GetReservedInstancesExchangeQuote',
                'ec2:GetSerialConsoleAccessStatus',
                'ec2:GetSpotPlacementScores',
                'ec2:GetSubnetCidrReservations',
                'ec2:GetTransitGatewayAttachmentPropagations',
                'ec2:GetTransitGatewayMulticastDomainAssociations',
                'ec2:GetTransitGatewayPrefixListReferences',
                'ec2:GetTransitGatewayRouteTableAssociations',
                'ec2:GetTransitGatewayRouteTablePropagations',
                'ec2:GetVpnConnectionDeviceSampleConfiguration',
                'ec2:GetVpnConnectionDeviceTypes',
                'ec2:ListSnapshotsInRecycleBin',
                'ecr-public:DescribeImageTags',
                'ecr-public:DescribeImages',
                'ecr-public:DescribeRegistries',
                'ecr-public:DescribeRepositories',
                'ecr-public:GetAuthorizationToken',
                'ecr-public:GetRegistryCatalogData',
                'ecr-public:GetRepositoryCatalogData',
                'ecr-public:GetRepositoryPolicy',
                'ecr-public:ListTagsForResource',
                'ecr:DescribeImageReplicationStatus',
                'ecr:DescribeImageScanFindings',
                'ecr:DescribeImages',
                'ecr:DescribePullThroughCacheRules',
                'ecr:DescribeRegistry',
                'ecr:DescribeRepositories',
                'ecr:GetAuthorizationToken',
                'ecr:GetDownloadUrlForLayer',
                'ecr:GetLifecyclePolicy',
                'ecr:GetLifecyclePolicyPreview',
                'ecr:GetRegistryPolicy',
                'ecr:GetRegistryScanningConfiguration',
                'ecr:GetRepositoryPolicy',
                'ecr:ListImages',
                'ecr:ListTagsForResource',
                'ecs:DescribeCapacityProviders',
                'ecs:DescribeClusters',
                'ecs:DescribeContainerInstances',
                'ecs:DescribeServices',
                'ecs:DescribeTaskDefinition',
                'ecs:DescribeTaskSets',
                'ecs:DescribeTasks',
                'ecs:ListAccountSettings',
                'ecs:ListAttributes',
                'ecs:ListClusters',
                'ecs:ListContainerInstances',
                'ecs:ListServices',
                'ecs:ListTagsForResource',
                'ecs:ListTaskDefinitionFamilies',
                'ecs:ListTaskDefinitions',
                'ecs:ListTasks',
                'eks:DescribeAddon',
                'eks:DescribeAddonVersions',
                'eks:DescribeCluster',
                'eks:DescribeFargateProfile',
                'eks:DescribeIdentityProviderConfig',
                'eks:DescribeNodegroup',
                'eks:DescribeUpdate',
                'eks:ListAddons',
                'eks:ListClusters',
                'eks:ListFargateProfiles',
                'eks:ListIdentityProviderConfigs',
                'eks:ListNodegroups',
                'eks:ListTagsForResource',
                'eks:ListUpdates',
                'elastic-inference:DescribeAcceleratorOfferings',
                'elastic-inference:DescribeAcceleratorTypes',
                'elastic-inference:DescribeAccelerators',
                'elastic-inference:ListTagsForResource',
                'elasticache:Describe*',
                'elasticache:List*',
                'elasticbeanstalk:Describe*',
                'elasticbeanstalk:List*',
                'elasticfilesystem:Describe*',
                'elasticfilesystem:List*',
                'elasticloadbalancing:Describe*',
                'elasticmapreduce:DescribeCluster',
                'elasticmapreduce:DescribeJobFlows',
                'elasticmapreduce:DescribeNotebookExecution',
                'elasticmapreduce:DescribeReleaseLabel',
                'elasticmapreduce:DescribeSecurityConfiguration',
                'elasticmapreduce:DescribeStep',
                'elasticmapreduce:DescribeStudio',
                'elasticmapreduce:GetAutoTerminationPolicy',
                'elasticmapreduce:GetBlockPublicAccessConfiguration',
                'elasticmapreduce:GetManagedScalingPolicy',
                'elasticmapreduce:GetStudioSessionMapping',
                'elasticmapreduce:ListBootstrapActions',
                'elasticmapreduce:ListClusters',
                'elasticmapreduce:ListInstanceFleets',
                'elasticmapreduce:ListInstanceGroups',
                'elasticmapreduce:ListInstances',
                'elasticmapreduce:ListNotebookExecutions',
                'elasticmapreduce:ListReleaseLabels',
                'elasticmapreduce:ListSecurityConfigurations',
                'elasticmapreduce:ListSteps',
                'elasticmapreduce:ListStudioSessionMappings',
                'elasticmapreduce:ListStudios',
                'elastictranscoder:ListPipelines',
                'elastictranscoder:ListPresets',
                'emr-containers:DescribeManagedEndpoint',
                'emr-containers:DescribeVirtualCluster',
                'emr-containers:ListManagedEndpoints',
                'emr-containers:ListTagsForResource',
                'emr-containers:ListVirtualClusters',
                'es:DescribeDomain',
                'es:DescribeDomainAutoTunes',
                'es:DescribeDomainConfig',
                'es:DescribeDomains',
                'es:DescribeElasticsearchDomain',
                'es:DescribeElasticsearchDomainConfig',
                'es:DescribeElasticsearchDomains',
                'es:DescribeElasticsearchInstanceTypeLimits',
                'es:DescribeInstanceTypeLimits',
                'es:DescribePackages',
                'es:DescribeReservedElasticsearchInstanceOfferings',
                'es:DescribeReservedElasticsearchInstances',
                'es:DescribeReservedInstanceOfferings',
                'es:DescribeReservedInstances',
                'es:GetCompatibleElasticsearchVersions',
                'es:GetCompatibleVersions',
                'es:GetPackageVersionHistory',
                'es:ListDomainNames',
                'es:ListDomainsForPackage',
                'es:ListElasticsearchInstanceTypes',
                'es:ListElasticsearchVersions',
                'es:ListInstanceTypeDetails',
                'es:ListPackagesForDomain',
                'es:ListTags',
                'es:ListVersions',
                'events:Describe*',
                'events:List*',
                'evidently:Get*',
                'evidently:List*',
                'finspace:GetEnvironment',
                'finspace:ListEnvironments',
                'finspace:ListTagsForResource',
                'firehose:DescribeDeliveryStream',
                'firehose:ListDeliveryStreams',
                'firehose:ListTagsForDeliveryStream',
                'fms:Get*',
                'fms:List*',
                'fsx:Describe*',
                'fsx:List*'
              ]
            Resource:
              - '*'
  FireflyReadonlyPolicyPart3:
    Type: 'AWS::IAM::ManagedPolicy'
    Properties:
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action: [
              'gamelift:Describe*',
                'gamelift:Get*',
                'gamelift:List*',
                'glacier:DescribeVault',
                'glacier:GetDataRetrievalPolicy',
                'glacier:GetVaultAccessPolicy',
                'glacier:GetVaultLock',
                'glacier:GetVaultNotifications',
                'glacier:ListMultipartUploads',
                'glacier:ListParts',
                'glacier:ListProvisionedCapacity',
                'glacier:ListTagsForVault',
                'glacier:ListVaults',
                'globalaccelerator:Describe*',
                'globalaccelerator:List*',
                'glue:GetBlueprint',
                'glue:GetBlueprintRun',
                'glue:GetBlueprintRuns',
                'glue:GetCatalogImportStatus',
                'glue:GetClassifier',
                'glue:GetClassifiers',
                'glue:GetColumnStatisticsForPartition',
                'glue:GetColumnStatisticsForTable',
                'glue:GetConnection',
                'glue:GetConnections',
                'glue:GetCrawler',
                'glue:GetCrawlerMetrics',
                'glue:GetCrawlers',
                'glue:GetDataCatalogEncryptionSettings',
                'glue:GetDatabase',
                'glue:GetDatabases',
                'glue:GetDataflowGraph',
                'glue:GetDevEndpoint',
                'glue:GetDevEndpoints',
                'glue:GetJob',
                'glue:GetJobBookmark',
                'glue:GetJobs',
                'glue:GetMLTaskRun',
                'glue:GetMLTaskRuns',
                'glue:GetMLTransform',
                'glue:GetMLTransforms',
                'glue:GetMapping',
                'glue:GetPartition',
                'glue:GetPartitionIndexes',
                'glue:GetPartitions',
                'glue:GetPlan',
                'glue:GetRegistry',
                'glue:GetResourcePolicies',
                'glue:GetResourcePolicy',
                'glue:GetSchema',
                'glue:GetSchemaByDefinition',
                'glue:GetSchemaVersion',
                'glue:GetSchemaVersionsDiff',
                'glue:GetSecurityConfiguration',
                'glue:GetSecurityConfigurations',
                'glue:GetTable',
                'glue:GetTableVersion',
                'glue:GetTableVersions',
                'glue:GetTables',
                'glue:GetTags',
                'glue:GetTrigger',
                'glue:GetTriggers',
                'glue:GetUserDefinedFunction',
                'glue:GetUserDefinedFunctions',
                'glue:GetWorkflow',
                'glue:GetWorkflowRun',
                'glue:GetWorkflowRunProperties',
                'glue:GetWorkflowRuns',
                'glue:ListBlueprints',
                'glue:ListCrawlers',
                'glue:ListDevEndpoints',
                'glue:ListJobs',
                'glue:ListMLTransforms',
                'glue:ListRegistries',
                'glue:ListSchemaVersions',
                'glue:ListSchemas',
                'glue:ListTriggers',
                'glue:ListWorkflows',
                'grafana:DescribeWorkspace',
                'grafana:DescribeWorkspaceAuthentication',
                'grafana:ListPermissions',
                'grafana:ListWorkspaces',
                'guardduty:DescribeOrganizationConfiguration',
                'guardduty:DescribePublishingDestination',
                'guardduty:GetDetector',
                'guardduty:GetFilter',
                'guardduty:GetIPSet',
                'guardduty:GetInvitationsCount',
                'guardduty:GetMasterAccount',
                'guardduty:GetMemberDetectors',
                'guardduty:GetMembers',
                'guardduty:GetThreatIntelSet',
                'guardduty:ListDetectors',
                'guardduty:ListFilters',
                'guardduty:ListFindings',
                'guardduty:ListIPSets',
                'guardduty:ListInvitations',
                'guardduty:ListMembers',
                'guardduty:ListOrganizationAdminAccounts',
                'guardduty:ListPublishingDestinations',
                'guardduty:ListTagsForResource',
                'guardduty:ListThreatIntelSets',
                'iam:GetAccountAuthorizationDetails',
                'iam:GetAccountPasswordPolicy',
                'iam:GetContextKeysForCustomPolicy',
                'iam:GetContextKeysForPrincipalPolicy',
                'iam:GetGroup',
                'iam:GetGroupPolicy',
                'iam:GetInstanceProfile',
                'iam:GetLoginProfile',
                'iam:GetOpenIDConnectProvider',
                'iam:GetOrganizationsAccessReport',
                'iam:GetPolicy',
                'iam:GetPolicyVersion',
                'iam:GetRole',
                'iam:GetRolePolicy',
                'iam:GetSAMLProvider',
                'iam:GetSSHPublicKey',
                'iam:GetServerCertificate',
                'iam:GetUser',
                'iam:GetUserPolicy',
                'iam:ListAccessKeys',
                'iam:ListAccountAliases',
                'iam:ListEntitiesForPolicy',
                'iam:ListGroupPolicies',
                'iam:ListGroups',
                'iam:ListGroupsForUser',
                'iam:ListInstanceProfileTags',
                'iam:ListInstanceProfiles',
                'iam:ListInstanceProfilesForRole',
                'iam:ListOpenIDConnectProviderTags',
                'iam:ListOpenIDConnectProviders',
                'iam:ListPolicies',
                'iam:ListPolicyTags',
                'iam:ListPolicyVersions',
                'iam:ListRolePolicies',
                'iam:ListRoleTags',
                'iam:ListRoles',
                'iam:ListSAMLProviderTags',
                'iam:ListSAMLProviders',
                'iam:ListSSHPublicKeys',
                'iam:ListServerCertificateTags',
                'iam:ListServerCertificates',
                'iam:ListServiceSpecificCredentials',
                'iam:ListSigningCertificates',
                'iam:ListUserPolicies',
                'iam:ListUserTags',
                'iam:ListUsers',
                'iam:ListVirtualMFADevices',
                'identitystore:DescribeGroup',
                'identitystore:DescribeUser',
                'identitystore:ListGroups',
                'identitystore:ListUsers',
                'imagebuilder:Get*',
                'imagebuilder:List*',
                'inspector2:DescribeOrganizationConfiguration',
                'inspector2:GetDelegatedAdminAccount',
                'inspector2:GetMember',
                'inspector2:ListAccountPermissions',
                'inspector2:ListDelegatedAdminAccounts',
                'inspector2:ListFilters',
                'inspector2:ListMembers',
                'inspector2:ListTagsForResource',
                'inspector:DescribeAssessmentTargets',
                'inspector:DescribeAssessmentTemplates',
                'inspector:DescribeCrossAccountAccessRole',
                'inspector:DescribeExclusions',
                'inspector:DescribeResourceGroups',
                'inspector:DescribeRulesPackages',
                'inspector:ListAssessmentTargets',
                'inspector:ListAssessmentTemplates',
                'inspector:ListEventSubscriptions',
                'inspector:ListExclusions',
                'inspector:ListRulesPackages',
                'inspector:ListTagsForResource'
              ]
            Resource:
              - '*'
  FireflyReadonlyPolicyPart4:
    Type: 'AWS::IAM::ManagedPolicy'
    Properties:
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action: [
              'kafka:Describe*',
                'kafka:Get*',
                'kafka:List*',
                'kafkaconnect:Describe*',
                'kafkaconnect:List*',
                'kinesis:DescribeLimits',
                'kinesis:DescribeStream',
                'kinesis:DescribeStreamConsumer',
                'kinesis:ListShards',
                'kinesis:ListStreamConsumers',
                'kinesis:ListStreams',
                'kinesis:ListTagsForStream',
                'kinesisanalytics:DescribeApplication',
                'kinesisanalytics:DescribeApplicationVersion',
                'kinesisanalytics:ListApplicationVersions',
                'kinesisanalytics:ListApplications',
                'kinesisanalytics:ListTagsForResource',
                'kinesisvideo:DescribeSignalingChannel',
                'kinesisvideo:DescribeStream',
                'kinesisvideo:GetDataEndpoint',
                'kinesisvideo:GetIceServerConfig',
                'kinesisvideo:GetSignalingChannelEndpoint',
                'kinesisvideo:ListSignalingChannels',
                'kinesisvideo:ListStreams',
                'kinesisvideo:ListTagsForResource',
                'kinesisvideo:ListTagsForStream',
                'kms:DescribeCustomKeyStores',
                'kms:DescribeKey',
                'kms:GetKeyPolicy',
                'kms:GetPublicKey',
                'kms:ListAliases',
                'kms:ListKeyPolicies',
                'kms:ListKeys',
                'kms:ListResourceTags',
                'lakeformation:DescribeResource',
                'lakeformation:GetDataLakeSettings',
                'lakeformation:GetEffectivePermissionsForPath',
                'lakeformation:GetLFTag',
                'lakeformation:GetResourceLFTags',
                'lakeformation:ListDataCellsFilter',
                'lakeformation:ListLFTags',
                'lakeformation:ListPermissions',
                'lakeformation:ListResources',
                'lakeformation:ListTableStorageOptimizers',
                'lambda:Get*',
                'lambda:List*',
                'lex:DescribeBot',
                'lex:DescribeBotAlias',
                'lex:DescribeBotLocale',
                'lex:DescribeBotVersion',
                'lex:DescribeIntent',
                'lex:DescribeResourcePolicy',
                'lex:DescribeSlot',
                'lex:DescribeSlotType',
                'lex:GetBot',
                'lex:GetBotAlias',
                'lex:GetBotAliases',
                'lex:GetBotChannelAssociation',
                'lex:GetBotChannelAssociations',
                'lex:GetBotVersions',
                'lex:GetBots',
                'lex:GetBuiltinIntent',
                'lex:GetBuiltinIntents',
                'lex:GetBuiltinSlotTypes',
                'lex:GetIntent',
                'lex:GetIntentVersions',
                'lex:GetIntents',
                'lex:GetSlotType',
                'lex:GetSlotTypeVersions',
                'lex:GetSlotTypes',
                'lex:GetUtterancesView',
                'lex:ListAggregatedUtterances',
                'lex:ListBotAliases',
                'lex:ListBotLocales',
                'lex:ListBotRecommendations',
                'lex:ListBotVersions',
                'lex:ListBots',
                'lex:ListBuiltInIntents',
                'lex:ListBuiltInSlotTypes',
                'lex:ListExports',
                'lex:ListImports',
                'lex:ListIntents',
                'lex:ListRecommendedIntents',
                'lex:ListSlotTypes',
                'lex:ListSlots',
                'lex:ListTagsForResource',
                'license-manager:GetLicense',
                'license-manager:GetLicenseConfiguration',
                'license-manager:GetLicenseManagerReportGenerator',
                'license-manager:GetServiceSettings',
                'license-manager:ListAssociationsForLicenseConfiguration',
                'license-manager:ListFailuresForLicenseConfigurationOperations',
                'license-manager:ListLicenseConfigurations',
                'license-manager:ListLicenseManagerReportGenerators',
                'license-manager:ListLicenseSpecificationsForResource',
                'license-manager:ListLicenseVersions',
                'license-manager:ListLicenses',
                'license-manager:ListResourceInventory',
                'license-manager:ListTagsForResource',
                'lightsail:GetActiveNames',
                'lightsail:GetAlarms',
                'lightsail:GetAutoSnapshots',
                'lightsail:GetBlueprints',
                'lightsail:GetBucketAccessKeys',
                'lightsail:GetBucketBundles',
                'lightsail:GetBuckets',
                'lightsail:GetBundles',
                'lightsail:GetCertificates',
                'lightsail:GetContactMethods',
                'lightsail:GetDisk',
                'lightsail:GetDisks',
                'lightsail:GetDistributionBundles',
                'lightsail:GetDistributions',
                'lightsail:GetDomain',
                'lightsail:GetDomains',
                'lightsail:GetInstance',
                'lightsail:GetInstancePortStates',
                'lightsail:GetInstances',
                'lightsail:GetKeyPair',
                'lightsail:GetKeyPairs',
                'lightsail:GetLoadBalancer',
                'lightsail:GetLoadBalancerTlsCertificates',
                'lightsail:GetLoadBalancers',
                'lightsail:GetRegions',
                'lightsail:GetRelationalDatabase',
                'lightsail:GetRelationalDatabaseBlueprints',
                'lightsail:GetRelationalDatabaseBundles',
                'lightsail:GetRelationalDatabaseLogStreams',
                'lightsail:GetRelationalDatabaseMasterUserPassword',
                'lightsail:GetRelationalDatabaseParameters',
                'lightsail:GetRelationalDatabases',
                'lightsail:GetStaticIp',
                'lightsail:GetStaticIps',
                'logs:DescribeDestinations',
                'logs:DescribeLogGroups',
                'logs:DescribeLogStreams',
                'logs:DescribeMetricFilters',
                'logs:DescribeResourcePolicies',
                'logs:DescribeSubscriptionFilters',
                'logs:ListTagsLogGroup'
              ]
            Resource:
              - '*'
  FireflyReadonlyPolicyPart5:
    Type: 'AWS::IAM::ManagedPolicy'
    Properties:
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action: [
              'machinelearning:Describe*',
                'machinelearning:Get*',
                'macie2:DescribeBuckets',
                'macie2:DescribeClassificationJob',
                'macie2:DescribeOrganizationConfiguration',
                'macie2:GetAdministratorAccount',
                'macie2:GetClassificationExportConfiguration',
                'macie2:GetCustomDataIdentifier',
                'macie2:GetFindingsFilter',
                'macie2:GetFindingsPublicationConfiguration',
                'macie2:GetInvitationsCount',
                'macie2:GetMasterAccount',
                'macie2:GetMember',
                'macie2:ListClassificationJobs',
                'macie2:ListCustomDataIdentifiers',
                'macie2:ListFindingsFilters',
                'macie2:ListInvitations',
                'macie2:ListManagedDataIdentifiers',
                'macie2:ListMembers',
                'macie2:ListOrganizationAdminAccounts',
                'macie2:ListTagsForResource',
                'macie:ListMemberAccounts',
                'macie:ListS3Resources',
                'managedblockchain:GetMember',
                'managedblockchain:GetNetwork',
                'managedblockchain:GetNode',
                'managedblockchain:ListInvitations',
                'managedblockchain:ListMembers',
                'managedblockchain:ListNetworks',
                'managedblockchain:ListNodes',
                'managedblockchain:ListTagsForResource',
                'mediaconvert:GetQueue',
                'mediaconvert:ListQueues',
                'mediaconvert:ListTagsForResource',
                'mediapackage:DescribeChannel',
                'mediapackage:DescribeOriginEndpoint',
                'mediapackage:ListChannels',
                'mediapackage:ListOriginEndpoints',
                'mediapackage:ListTagsForResource',
                'mediastore:DescribeContainer',
                'mediastore:GetContainerPolicy',
                'mediastore:GetCorsPolicy',
                'mediastore:GetLifecyclePolicy',
                'mediastore:GetMetricPolicy',
                'mediastore:ListContainers',
                'mediastore:ListTagsForResource',
                'memorydb:DescribeACLs',
                'memorydb:DescribeClusters',
                'memorydb:DescribeEngineVersions',
                'memorydb:DescribeEvents',
                'memorydb:DescribeParameterGroups',
                'memorydb:DescribeServiceUpdates',
                'memorydb:DescribeSnapshots',
                'memorydb:DescribeSubnetGroups',
                'memorydb:DescribeUsers',
                'memorydb:ListTags',
                'mobilehub:DescribeBundle',
                'mobilehub:ListBundles',
                'mobilehub:ListProjects',
                'mobiletargeting:Get*',
                'mobiletargeting:List*',
                'mq:Describe*',
                'mq:List*',
                'network-firewall:Describe*',
                'network-firewall:List*',
                'networkmanager:Describe*',
                'networkmanager:Get*',
                'networkmanager:List*',
                'opsworks-cm:Describe*',
                'opsworks-cm:List*',
                'opsworks:Describe*',
                'opsworks:Get*',
                'opsworks:List*',
                'organizations:Describe*',
                'organizations:List*',
                'outposts:Get*',
                'outposts:List*',
                'panorama:Describe*',
                'panorama:List*',
                'pi:Describe*',
                'pi:Get*',
                'polly:DescribeVoices',
                'polly:Get*',
                'polly:List*',
                'profile:List*',
                'proton:Get*',
                'proton:List*',
                'qldb:Describe*',
                'qldb:Get*',
                'qldb:List*',
                'quicksight:Describe*',
                'quicksight:Get*',
                'quicksight:List*',
                'ram:Get*',
                'ram:List*',
                'rbin:Get*',
                'rbin:List*',
                'rds:Describe*',
                'rds:List*',
                'redshift-data:Describe*',
                'redshift-data:Get*',
                'redshift-data:List*',
                'redshift:Describe*',
                'redshift:Get*',
                'refactor-spaces:Get*',
                'refactor-spaces:List*',
                'rekognition:Describe*',
                'rekognition:Get*',
                'rekognition:List*',
                'resiliencehub:Describe*',
                'resiliencehub:List*',
                'resource-groups:Get*',
                'resource-groups:List*',
                'robomaker:Describe*',
                'robomaker:Get*',
                'robomaker:List*',
                'route53-recovery-cluster:Get*',
                'route53-recovery-control-config:Describe*',
                'route53-recovery-control-config:List*',
                'route53-recovery-readiness:Get*',
                'route53-recovery-readiness:List*',
                'route53:Get*',
                'route53:List*',
                'route53domains:Get*',
                'route53domains:List*',
                'route53resolver:Get*',
                'route53resolver:List*',
                'rum:Get*',
                's3-outposts:List*',
                's3:Describe*',
                's3:Get*',
                's3:List*',
                'sagemaker:Describe*',
                'sagemaker:Get*',
                'sagemaker:List*',
                'savingsplans:Describe*',
                'savingsplans:ListTagsForResource',
                'schemas:Describe*',
                'schemas:Get*',
                'schemas:List*',
                'sdb:GetAttributes',
                'sdb:ListDomains',
                'secretsmanager:DescribeSecret',
                'secretsmanager:GetResourcePolicy',
                'secretsmanager:List*',
                'securityhub:Describe*',
                'securityhub:Get*',
                'securityhub:List*',
                'serverlessrepo:Get*',
                'serverlessrepo:List*',
                'servicecatalog:Describe*',
                'servicecatalog:Get*',
                'servicecatalog:List*',
                'servicediscovery:Get*',
                'servicediscovery:List*',
                'servicequotas:Get*',
                'servicequotas:List*',
                'ses:Describe*',
                'ses:Get*',
                'ses:List*',
                'shield:Describe*',
                'shield:Get*',
                'shield:List*',
                'signer:Describe*',
                'signer:Get*',
                'signer:List*',
                'sms-voice:Get*',
                'sms-voice:List*',
                'sms:Get*',
                'sms:List*',
                'snow-device-management:Describe*',
                'snow-device-management:List*',
                'snowball:Describe*',
                'snowball:Get*',
                'snowball:List*',
                'sns:Get*',
                'sns:List*',
                'sqs:Get*',
                'sqs:List*',
                'ssm-contacts:Describe*',
                'ssm-contacts:Get*',
                'ssm-contacts:List*',
                'ssm-incidents:Get*',
                'ssm-incidents:List*',
                'ssm:Describe*',
                'ssm:Get*',
                'ssm:List*',
                'sso:Describe*',
                'sso:Get*',
                'sso:List*',
                'states:Describe*',
                'states:List*',
                'storagegateway:Describe*',
                'storagegateway:List*',
                'sts:GetAccessKeyInfo',
                'sts:GetCallerIdentity',
                'sts:GetSessionToken',
                'swf:Describe*',
                'swf:List*',
                'synthetics:Describe*',
                'synthetics:Get*',
                'synthetics:List*',
                'textract:Get*',
                'timestream:Describe*',
                'timestream:List*',
                'transcribe:Describe*',
                'transcribe:Get*',
                'transcribe:List*',
                'transfer:Describe*',
                'transfer:List*',
                'translate:Describe*',
                'translate:Get*',
                'translate:List*',
                'voiceid:Describe*',
                'voiceid:List*',
                'waf-regional:Get*',
                'waf-regional:List*',
                'waf:Get*',
                'waf:List*',
                'wafv2:Describe*',
                'wafv2:Get*',
                'wafv2:List*',
                'wisdom:Get*',
                'wisdom:List*',
                'worklink:DescribeA*',
                'worklink:List*',
                'workmail:Describe*',
                'workmail:List*',
                'xray:Get*',
                'xray:List*'
              ]
            Resource:
              - '*'
  FireflyCrossAccountAccessRole:
    Type: 'AWS::IAM::Role'
    Properties:
      RoleName: 'firefly-caa-role'
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Action: 'sts:AssumeRole'
            Effect: Allow
            Principal:
              AWS: !Join
                - ''
                - - 'arn:aws:iam::'
                  - !FindInMap
                    - FireflyEnvironment
                    - env
                    - organizationID
                  - ':root'
            Condition:
              StringEquals:
                'sts:ExternalId': !Ref ExternalID
      ManagedPolicyArns:
        - 'arn:aws:iam::aws:policy/SecurityAudit'
        - 'arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess'
        - !Ref FireflyReadonlyPolicy
        - !Ref FireflyReadonlyPolicyPart1
        - !Ref FireflyReadonlyPolicyPart2
        - !Ref FireflyReadonlyPolicyPart3
        - !Ref FireflyReadonlyPolicyPart4
        - !Ref FireflyReadonlyPolicyPart5
Outputs:
  RoleARN:
    Description: >-
      Cross-account access role ARN to share with Firefly
      integration
    Value: !GetAtt
      - FireflyCrossAccountAccessRole
      - Arn
  ExternalID:
    Description: ExternalID to share with Firefly
    Value: !Ref ExternalID
  TemplateVersion:
    Description: gofirefly.io template version
    Value: 1.0.0
